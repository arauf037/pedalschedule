<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Padel Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#f8f9fa; }
    .live-btn { background:red; color:white; }
  </style>
</head>
<body class="container py-4">
  <h1 class="text-center mb-4">Admin Panel - Padel Tournament</h1>

  <div id="fixtures"></div>

  <h2 class="mt-5">Standings</h2>
  <table class="table table-striped" id="standingsTable">
    <thead>
      <tr>
        <th>Team</th><th>Wins</th><th>Losses</th><th>PF</th><th>PA</th><th>Diff</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // 🔑 Replace with your Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDYvq9eXpYplV4qp65G106LJfHaBoPF23o",
  authDomain: "pedalschedule.firebaseapp.com",
  databaseURL: "https://pedalschedule-default-rtdb.firebaseio.com",
  projectId: "pedalschedule",
  storageBucket: "pedalschedule.firebasestorage.app",
  messagingSenderId: "46444074383",
  appId: "1:46444074383:web:4351f250d95fac4378a7fa",
  measurementId: "G-14CKBVRF1L"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function renderFixtures(fixtures) {
      const container = document.getElementById("fixtures");
      container.innerHTML = "";

      fixtures.forEach(match => {
        const div = document.createElement("div");
        div.className = "card mb-3";
        div.innerHTML = `
          <div class="card-body">
            <h5>Match #${match.matchNo} (Court ${match.court}): ${match.teamA} vs ${match.teamB}</h5>
            <div class="row g-2">
              <div class="col">
                <input type="number" class="form-control scoreA" value="${match.scoreA}" placeholder="Score A">
              </div>
              <div class="col">
                <input type="number" class="form-control scoreB" value="${match.scoreB}" placeholder="Score B">
              </div>
              <div class="col">
                <button class="btn btn-success save-btn">Save</button>
                <button class="btn live-btn">Live</button>
              </div>
            </div>
          </div>`;
        container.appendChild(div);

        // Save button
        div.querySelector(".save-btn").onclick = () => {
          const scoreA = parseInt(div.querySelector(".scoreA").value) || 0;
          const scoreB = parseInt(div.querySelector(".scoreB").value) || 0;
          let winner = "";
          if (scoreA > scoreB) winner = match.teamA;
          else if (scoreB > scoreA) winner = match.teamB;

          db.ref("fixtures/" + (match.matchNo-1)).update({ scoreA, scoreB, winner });
          updateStandings(match, scoreA, scoreB, winner);
        };

        // Live button
        div.querySelector(".live-btn").onclick = () => {
          db.ref("liveMatches").once("value").then(snap => {
            let live = snap.val() || [];
            const alreadyLive = live.includes(match.matchNo);

            if (alreadyLive) {
              // Unmark live
              live = live.filter(m => m !== match.matchNo);
            } else {
              if (live.length >= 2) {
                alert("⚠️ Only 2 matches can be live at once!");
                return;
              }
              live.push(match.matchNo);
            }
            db.ref("liveMatches").set(live);
          });
        };
      });
    }

    function updateStandings(match, scoreA, scoreB, winner) {
      db.ref("standings").once("value").then(snap => {
        const standings = snap.val();
        const teamA = standings.find(t => t.team === match.teamA);
        const teamB = standings.find(t => t.team === match.teamB);

        teamA.pointsFor += scoreA;
        teamA.pointsAgainst += scoreB;
        teamB.pointsFor += scoreB;
        teamB.pointsAgainst += scoreA;

        if (winner === match.teamA) { teamA.wins++; teamB.losses++; }
        else if (winner === match.teamB) { teamB.wins++; teamA.losses++; }

        db.ref("standings").set(standings);
      });
    }

    function renderStandings(data) {
      const tbody = document.querySelector("#standingsTable tbody");
      tbody.innerHTML = "";
      data.forEach(t => {
        tbody.innerHTML += `
          <tr>
            <td>${t.team}</td>
            <td>${t.wins}</td>
            <td>${t.losses}</td>
            <td>${t.pointsFor}</td>
            <td>${t.pointsAgainst}</td>
            <td>${t.pointsFor - t.pointsAgainst}</td>
          </tr>`;
      });
    }

    db.ref("fixtures").on("value", snap => renderFixtures(snap.val() || []));
    db.ref("standings").on("value", snap => renderStandings(snap.val() || []));
  </script>
</body>
</html>
