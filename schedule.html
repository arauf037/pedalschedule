<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Tournament</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
      background-color: #f9f9f9;
    }
    .team-A { background:#304d6d; color:#fff; }
    .team-B { background:#a67045; color:#fff; }
    .team-C { background:#a2ce3c; color:#fff; }
    .team-D { background:#198754; color:#fff; }
    .team-E { background:#d68a30; color:#fff; }
    .team-F { background:#6f42c1; color:#fff; }
    .live-badge {
      background: red;
      color: #fff;
      font-weight: bold;
      animation: blink 1s infinite;
    }
    @keyframes blink {
      50% { opacity: 0.4; }
    }
  </style>
</head>
<body class="container py-3">

  <h2 class="text-center mb-4">üèê Tournament Admin Panel</h2>

  <div id="fixtures" class="mb-5"></div>

  <h4 class="mb-3">üìä Standings</h4>
  <table class="table table-bordered table-striped text-center">
    <thead class="table-dark">
      <tr>
        <th>Team</th>
        <th>W</th>
        <th>L</th>
        <th>PF</th>
        <th>PA</th>
        <th>+/-</th>
      </tr>
    </thead>
    <tbody id="standings"></tbody>
  </table>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // üîπ Your Firebase config
  const firebaseConfig = {
  apiKey: "AIzaSyDYvq9eXpYplV4qp65G106LJfHaBoPF23o",
  authDomain: "pedalschedule.firebaseapp.com",
  databaseURL: "https://pedalschedule-default-rtdb.firebaseio.com",
  projectId: "pedalschedule",
  storageBucket: "pedalschedule.firebasestorage.app",
  messagingSenderId: "46444074383",
  appId: "1:46444074383:web:4351f250d95fac4378a7fa",
  measurementId: "G-14CKBVRF1L"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // üîπ Render Fixtures
    function renderFixtures(data) {
      const container = document.getElementById("fixtures");
      container.innerHTML = "<h4 class='mb-3'>üóì Fixtures</h4>";
      data.fixtures.forEach(match => {
        const div = document.createElement("div");
        div.className = "card mb-3";
        div.innerHTML = `
          <div class="card-body">
            <h6>Match ${match.id} - Court ${match.court} 
              ${match.live ? "<span class='badge live-badge'>LIVE</span>" : ""}
            </h6>
            <div class="row">
              <div class="col-5 text-center p-2 ${getTeamClass(match.teamA)}">${match.teamA}</div>
              <div class="col-2 text-center">vs</div>
              <div class="col-5 text-center p-2 ${getTeamClass(match.teamB)}">${match.teamB}</div>
            </div>
            <div class="row mt-2">
              <div class="col">
                <input type="number" id="scoreA-${match.id}" class="form-control" placeholder="Score A" value="${match.scoreA}">
              </div>
              <div class="col">
                <input type="number" id="scoreB-${match.id}" class="form-control" placeholder="Score B" value="${match.scoreB}">
              </div>
            </div>
            <div class="mt-2">
              <button class="btn btn-success btn-sm" onclick="updateMatch(${match.id})">Update</button>
              <button class="btn btn-danger btn-sm" onclick="resetMatch(${match.id})">Reset</button>
              <button class="btn btn-warning btn-sm" onclick="toggleLive(${match.id})">${match.live ? "Unset Live" : "Set Live"}</button>
            </div>
          </div>
        `;
        container.appendChild(div);
      });
    }

    function getTeamClass(name) {
     
      if (name.includes("Fawad")) return "team-A";
      if (name.includes("Rauf")) return "team-B";
      if (name.includes("Usman")) return "team-C";
      if (name.includes("Hanan")) return "team-D";
      if (name.includes("Salman")) return "team-E";
      if (name.includes("Zaheer")) return "team-F";
      return "";
    }

    // üîπ Update Match
    function updateMatch(id) {
      db.ref("fixtures").once("value", snapshot => {
        const fixtures = snapshot.val();
        const match = fixtures.find(m => m.id === id);

        const scoreA = parseInt(document.getElementById(`scoreA-${id}`).value) || 0;
        const scoreB = parseInt(document.getElementById(`scoreB-${id}`).value) || 0;

        match.scoreA = scoreA;
        match.scoreB = scoreB;
        match.winner = scoreA === scoreB ? "" : (scoreA > scoreB ? match.teamA : match.teamB);

        db.ref("fixtures").set(fixtures);

        updateStandingsFromFixtures(fixtures);
      });
    }

    // üîπ Reset Match
    function resetMatch(id) {
      db.ref("fixtures").once("value", snapshot => {
        const fixtures = snapshot.val();
        const match = fixtures.find(m => m.id === id);

        match.scoreA = 0;
        match.scoreB = 0;
        match.winner = "";

        db.ref("fixtures").set(fixtures);
        updateStandingsFromFixtures(fixtures);
      });
    }

    // üîπ Toggle Live (max 2)
    function toggleLive(id) {
      db.ref("fixtures").once("value", snapshot => {
        const fixtures = snapshot.val();
        let liveCount = fixtures.filter(m => m.live).length;

        const match = fixtures.find(m => m.id === id);
        if (!match.live && liveCount >= 2) {
          alert("‚ö† Only 2 matches can be live at a time!");
          return;
        }
        match.live = !match.live;

        db.ref("fixtures").set(fixtures);
      });
    }

    // üîπ Standings Calculation
    function updateStandingsFromFixtures(fixtures) {
      db.ref("standings").once("value", snapshot => {
        let standings = snapshot.val();

        // Reset
        standings.forEach(t => {
          t.wins = 0; t.losses = 0; t.pf = 0; t.pa = 0; t.diff = 0;
        });

        fixtures.forEach(m => {
          if (m.scoreA === 0 && m.scoreB === 0) return;

          let teamA = standings.find(t => t.team === m.teamA);
          let teamB = standings.find(t => t.team === m.teamB);

          teamA.pf += m.scoreA;
          teamA.pa += m.scoreB;
          teamB.pf += m.scoreB;
          teamB.pa += m.scoreA;

          if (m.scoreA > m.scoreB) { teamA.wins++; teamB.losses++; }
          else if (m.scoreB > m.scoreA) { teamB.wins++; teamA.losses++; }

          teamA.diff = teamA.pf - teamA.pa;
          teamB.diff = teamB.pf - teamB.pa;
        });

        db.ref("standings").set(standings);
      });
    }

    // üîπ Render Standings
    function renderStandings(data) {
      const tbody = document.getElementById("standings");
      tbody.innerHTML = "";
      data.sort((a,b) => b.wins - a.wins || b.diff - a.diff);
      data.forEach(t => {
        tbody.innerHTML += `
          <tr>
            <td>${t.team}</td>
            <td>${t.wins}</td>
            <td>${t.losses}</td>
            <td>${t.pf}</td>
            <td>${t.pa}</td>
            <td>${t.diff}</td>
          </tr>`;
      });
    }

    // üîπ Live Sync
    db.ref("fixtures").on("value", snapshot => {
      const fixtures = snapshot.val();
      renderFixtures({ fixtures });
    });

    db.ref("standings").on("value", snapshot => {
      renderStandings(snapshot.val());
    });
  </script>
</body>
</html>
